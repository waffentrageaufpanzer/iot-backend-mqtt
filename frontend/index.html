<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IoT Platform</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-theme="dark">
  <div id="authPage" class="full-center">
    <div class="auth-card">
      <div class="auth-topbar">
        <div class="lang-toggle" id="authLangToggle">
          <button type="button" data-lang="vi">VI</button>
          <button type="button" data-lang="en">EN</button>
        </div>
        <button type="button" class="icon-btn" id="authThemeToggle">ğŸŒ™</button>
      </div>
      <h1 class="auth-title">ğŸ“¡ IoT Platform</h1>
      
      <div class="row" style="margin-top:4px;">
        <button class="secondary btn-sm" type="button" id="toggleApiBaseBtn">âš™ Backend URL</button>
      </div>
      <div class="row" id="apiBaseRow" style="display:none;">
        <input id="apiBaseInput" placeholder="https://...railway.app" />
        <button class="secondary btn-sm" id="saveApiBaseBtn" type="button">LÆ°u</button>
      </div>

      <div class="tabs">
        <button id="tabLogin" class="active" onclick="switchAuth('login')">ÄÄƒng nháº­p</button>
        <button id="tabRegister" onclick="switchAuth('register')">ÄÄƒng kÃ½</button>
      </div>

      <div id="loginForm">
        <div class="row"><input id="loginUser" placeholder="Username" /></div>
        <div class="row"><input id="loginPass" type="password" placeholder="Password" /></div>
        <div class="row"><button id="loginBtn" type="button">ÄÄƒng nháº­p</button></div>
      </div>

      <div id="registerForm" style="display:none;">
        <div class="row"><input id="regUser" placeholder="Username" /></div>
        <div class="row"><input id="regEmail" type="email" placeholder="Email" /></div>
        <div class="row"><input id="regPass" type="password" placeholder="Password" /></div>
        <div class="row"><input id="regPassConfirm" type="password" placeholder="Confirm Pass" /></div>
        <div class="row"><button id="registerBtn" type="button">ÄÄƒng kÃ½</button></div>
        <div class="row" style="align-items: center; gap: 5px; flex-direction: row;">
          <input id="otpInput" placeholder="OTP (6 sá»‘)" style="width:100px" />
          <button class="secondary btn-sm" id="verifyOtpBtn">Verify</button>
        </div>
      </div>
    </div>
  </div>

  <div id="appPage" style="display:none;">
    <div class="layout">
      <aside class="sidebar" id="sideNav">
        <div class="sidebar-top">
          <span class="sidebar-logo">IoT</span>
          <button class="icon-btn" id="sideNavToggle">â˜°</button>
        </div>
        <div class="sidebar-nav">
          <button class="nav-item active" data-tab="dashboard"><span class="nav-icon">ğŸ“Š</span> Dash</button>
          <button class="nav-item" data-tab="devices"><span class="nav-icon">ğŸ”Œ</span> Device</button>
          <button class="nav-item" data-tab="cameras"><span class="nav-icon">ğŸ“·</span> Cam</button>
          <button class="nav-item" data-tab="admin" id="navAdmin" style="display:none"><span class="nav-icon">ğŸ›¡ï¸</span> Admin</button>
        </div>
      </aside>

      <div class="card">
        <div class="app-header">
          <div class="app-title-text">IoT Platform <span id="userBadge" class="pill small"></span></div>
          <div class="header-right">
            <button class="icon-btn" id="appThemeToggle">ğŸŒ™</button>
            <button id="logoutBtn" class="secondary btn-sm">ThoÃ¡t</button>
          </div>
        </div>

        <section id="dashboardSection">
          <div class="dash-toolbar">
            <button id="dashModeBtn" class="secondary btn-sm">Edit Mode</button>
            <div class="widget-palette">
              <button class="widget-add-main" id="widgetPaletteToggle">ï¼‹ Widget</button>
              <div class="widget-palette-menu" id="widgetPaletteMenu">
                <button class="widget-type-btn" data-type="button">ğŸŸ£ Button</button>
                <button class="widget-type-btn" data-type="switch">â» Switch</button>
                <button class="widget-type-btn" data-type="slider">ğŸšï¸ Slider</button>
                <button class="widget-type-btn" data-type="thermo">ğŸŒ¡ï¸ Thermo</button>
                <button class="widget-type-btn" data-type="gauge">ğŸ“ˆ Gauge</button>
                <button class="widget-type-btn" data-type="dpad">ğŸ•¹ï¸ D-Pad</button>
                <button class="widget-type-btn" data-type="camera">ğŸ“· Camera</button>
              </div>
            </div>
          </div>
          <div id="widgetGrid" class="widget-grid"><div class="empty-hint">ChÆ°a cÃ³ widget.</div></div>
        </section>

        <section id="devicesSection" style="display:none;">
          <div class="row" style="flex-direction:row; gap:5px;">
            <input id="claimDeviceId" placeholder="Device ID" />
            <input id="claimDeviceName" placeholder="Name" />
            <button class="secondary btn-sm" id="claimBtn">Add</button>
            <button id="refreshBtn" class="btn-sm">Refresh</button>
          </div>
          <div class="device-list-wrapper">
            <table>
              <thead><tr><th>ID</th><th>TÃªn</th><th>Status</th><th>Val</th><th>Time</th><th>Ctrl</th></tr></thead>
              <tbody id="deviceTableBody"></tbody>
            </table>
          </div>

          <hr style="border-color:#334155; margin:10px 0"/>
          <div class="small"><b>ESP32 Firmware Gen</b></div>
          <div class="row" style="flex-direction:row; flex-wrap:wrap; gap:5px;">
            <input id="fwDeviceId" placeholder="Dev ID" style="width:120px" />
            <input id="fwWifiSsid" placeholder="WiFi SSID" style="width:120px" />
            <input id="fwWifiPass" placeholder="WiFi Pass" style="width:120px" />
            <input id="fwMqttHost" placeholder="Broker" style="width:150px" value="broker.hivemq.com" />
          </div>
          <div class="device-list-wrapper" style="max-height:150px">
            <table>
              <tbody id="fwPinsTableBody"></tbody>
            </table>
            <button id="fwAddPinBtn" class="secondary btn-sm" style="margin:5px">+ Pin</button>
          </div>
          <div class="row" style="flex-direction:row; gap:5px; margin-top:5px">
            <button id="fwGenerateBtn" class="btn-sm">Generate Code</button>
            <button id="fwCopyBtn" class="secondary btn-sm">Copy</button>
            <span id="fwCopyStatus" class="small"></span>
          </div>
          <textarea id="fwCodeOutput" style="width:100%; height:150px; background:#0f172a; color:#ccc; margin-top:5px"></textarea>
        </section>

        <section id="camerasSection" style="display:none;">
          <div class="row" style="flex-direction:row; gap:5px;">
            <input id="camIdInput" placeholder="Cam ID" />
            <input id="camNameInput" placeholder="Name" />
            <input id="camUrlInput" placeholder="Snapshot URL" />
            <button id="camRegisterBtn" class="secondary btn-sm">Add</button>
          </div>
          <div class="device-list-wrapper">
            <table>
              <thead><tr><th>ID</th><th>Name</th><th>Action</th></tr></thead>
              <tbody id="cameraTableBody"></tbody>
            </table>
          </div>
          <hr style="border-color:#334155; margin:10px 0"/>
          <div class="row" style="flex-direction:row; gap:5px; align-items:center">
            <button id="startStreamBtn" class="secondary btn-sm">Start Stream</button>
            <button id="stopStreamBtn" class="danger btn-sm" disabled>Stop</button>
            <span id="camStreamStatus" class="small">Stopped</span>
          </div>
          <div class="row" style="flex-direction:row; gap:10px; margin-top:10px">
            <div style="flex:1"><div class="small">Local:</div><video id="localVideo" autoplay muted style="width:100%; border-radius:8px"></video></div>
            <div style="flex:1"><div class="small">Server:</div><img id="serverVideo" style="width:100%; border-radius:8px" /></div>
          </div>
        </section>

        <section id="adminSection" style="display:none;">
          <div class="device-list-wrapper">
            <table>
              <thead><tr><th>ID</th><th>User</th><th>Role</th><th>Action</th></tr></thead>
              <tbody id="adminUserTableBody"></tbody>
            </table>
          </div>
        </section>
      </div>

      <div class="card detail-card" id="detailPanel">
        <h2 style="font-size:14px; margin:0 0 10px">Chi tiáº¿t</h2>
        <div id="detailEmpty" class="small">Chá»n thiáº¿t bá»‹ Ä‘á»ƒ xem.</div>
        
        <div id="deviceDetailPanel" style="display:none;">
          <div class="small">ID: <b id="detailId"></b></div>
          <div class="small">Name: <b id="detailName"></b></div>
          <div class="small">State: <span id="detailState"></span></div>
          <div class="small">Val: <b id="detailValue"></b></div>
          <div class="small" style="margin-top:5px">Sensors:</div>
          <div id="detailSensors" class="small" style="background:#1e293b; padding:5px; border-radius:4px"></div>
          <canvas id="historyCanvas" style="width:100%; height:100px; margin-top:10px"></canvas>
        </div>

        <div id="cameraDetailPanel" style="display:none;">
          <div class="small">ID: <b id="camDetailId"></b></div>
          <div class="small">URL: <a id="camDetailUrl" target="_blank" href="#">Link</a></div>
          <img id="camDetailImg" class="cam-preview" style="width:100%; margin-top:5px; border-radius:4px" />
        </div>
      </div>
    </div>
  </div>

  <div id="widgetConfigOverlay" class="widget-config-overlay">
    <div id="widgetConfigPanel" class="widget-config">
      <div class="widget-config-header">
        <span>Cáº¥u hÃ¬nh</span><button class="icon-btn btn-sm" id="widgetConfigCloseBtn">âœ•</button>
      </div>
      <div class="widget-config-form">
        <div class="widget-config-row"><span>TÃªn</span><input id="widgetConfigTitle" /></div>
        <div class="widget-config-row"><span>Device</span><select id="widgetConfigDevice"></select></div>
        <div class="widget-config-row"><span>Camera</span><select id="widgetConfigCamera"></select></div>
        <div class="widget-config-row"><span>Sensor Key</span><input id="widgetConfigSensor" placeholder="temp, hum..." /></div>
        <div class="widget-config-row"><span>MÃ u</span>
          <select id="widgetConfigTheme">
            <option value="green">Xanh lÃ¡</option><option value="blue">Xanh dÆ°Æ¡ng</option>
            <option value="amber">Cam</option><option value="pink">Há»“ng</option>
          </select>
        </div>
        <div class="widget-config-row"><span>Size</span>
          <select id="widgetConfigSize">
            <option value="s">Nhá» (3 Ã´)</option><option value="m">Vá»«a (4 Ã´)</option><option value="l">Lá»›n (6 Ã´)</option>
          </select>
        </div>
        <div class="widget-config-row" id="widgetConfigRangeRow" style="display:none">
          <span>Range</span><input id="widgetConfigRangeMin" type="number" placeholder="Min" style="width:60px" />
          <input id="widgetConfigRangeMax" type="number" placeholder="Max" style="width:60px" />
        </div>
      </div>
    </div>
  </div>

  <script>
    // Script nhá» Ä‘á»ƒ switch tab Auth
    function switchAuth(tab) {
      document.getElementById('loginForm').style.display = tab==='login'?'block':'none';
      document.getElementById('registerForm').style.display = tab==='register'?'block':'none';
      document.getElementById('tabLogin').className = tab==='login'?'active':'';
      document.getElementById('tabRegister').className = tab==='register'?'active':'';
    }
  </script>
  <script src="app.js" defer></script>
</body>
</html>