<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IoT Platform</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body data-theme="light">
  
  <div id="authPage" class="full-center">
    <div class="auth-card">
      <div class="auth-topbar">
        <h1 class="auth-title" style="margin:0">ğŸ“¡ IoT Login</h1>
        <button class="icon-btn" id="authThemeToggle">ğŸŒ—</button>
      </div>
      
      <div class="row" style="margin-bottom:15px">
        <button class="btn-neu-rect" type="button" id="toggleApiBaseBtn" style="font-size:11px; padding:5px 10px">âš™ Backend URL</button>
        <div id="apiBaseRow" style="display:none; margin-top:5px; gap:5px; flex-direction:column">
          <input id="apiBaseInput" placeholder="https://...railway.app" />
          <button class="btn-neu-rect" id="saveApiBaseBtn">LÆ°u</button>
        </div>
      </div>

      <div class="tabs">
        <button id="tabLogin" class="active" onclick="switchAuth('login')">ÄÄƒng nháº­p</button>
        <button id="tabRegister" onclick="switchAuth('register')">ÄÄƒng kÃ½</button>
      </div>

      <div id="loginForm">
        <input id="loginUser" placeholder="Username" />
        <input id="loginPass" type="password" placeholder="Password" />
        <button id="loginBtn" class="btn-neu-rect" style="width:100%; color: var(--acc); margin-top:10px">ÄÄ‚NG NHáº¬P</button>
      </div>

      <div id="registerForm" style="display:none;">
        <input id="regUser" placeholder="Username" />
        <input id="regEmail" type="email" placeholder="Email" />
        <input id="regPass" type="password" placeholder="Password" />
        <input id="regPassConfirm" type="password" placeholder="Confirm Pass" />
        <div style="display:flex; gap:10px; align-items:center; margin-bottom:15px; margin-top:10px">
           <input id="otpInput" placeholder="OTP" style="margin:0" />
           <button class="btn-neu-rect" id="verifyOtpBtn">Verify</button>
        </div>
        <button id="registerBtn" class="btn-neu-rect" style="width:100%">ÄÄ‚NG KÃ</button>
      </div>
    </div>
  </div>

  <div id="appPage" class="hidden">
    <div class="layout">
      <aside class="sidebar" id="sideNav">
        <div class="sidebar-top">
          <span class="sidebar-logo">IOT CONTROLLER</span>
          <button class="icon-btn" id="sideNavToggle">â˜°</button>
        </div>
        <div class="sidebar-nav">
          <button class="nav-item btn-neu-rect active" data-tab="dashboard">ğŸ“Š Dashboard</button>
          <button class="nav-item btn-neu-rect" data-tab="devices">ğŸ”Œ Devices</button>
          <button class="nav-item btn-neu-rect" data-tab="cameras">ğŸ“· Cameras</button>
          <button class="nav-item btn-neu-rect" data-tab="admin" id="navAdmin">ğŸ›¡ï¸ Admin</button>
        </div>
      </aside>

      <div class="main-content">
        <div class="app-header">
          <div class="app-title-text">Hi, <span id="userBadge">User</span></div>
          <div class="header-right">
            <button class="icon-btn" id="appThemeToggle">ğŸŒ—</button>
            <button id="logoutBtn" class="btn-neu-rect" style="color:var(--danger)">ThoÃ¡t</button>
          </div>
        </div>

        <section id="dashboardSection">
          <div class="dash-toolbar">
            <button id="dashModeBtn" class="btn-neu-rect">Edit Mode</button>
            <div class="widget-palette">
              <button class="btn-neu-rect" id="widgetPaletteToggle">ï¼‹ Widget</button>
              <div class="widget-palette-menu" id="widgetPaletteMenu">
                <button class="widget-type-btn" data-type="button">ğŸŸ£ Button</button>
                <button class="widget-type-btn" data-type="switch">â» Switch</button>
                <button class="widget-type-btn" data-type="slider">ğŸšï¸ Slider</button>
                <button class="widget-type-btn" data-type="thermo">ğŸŒ¡ï¸ Thermo</button>
                <button class="widget-type-btn" data-type="gauge">ğŸ“ˆ Gauge</button>
                <button class="widget-type-btn" data-type="dpad">ğŸ•¹ï¸ D-Pad</button>
                <button class="widget-type-btn" data-type="camera">ğŸ“· Camera</button>
              </div>
            </div>
          </div>
          <div id="widgetGrid" class="widget-grid"><div class="empty-hint">ChÆ°a cÃ³ widget.</div></div>
        </section>

        <section id="devicesSection" class="hidden">
          <div class="row" style="flex-direction:row; gap:10px; margin-bottom:15px">
            <input id="claimDeviceId" placeholder="Device ID" />
            <input id="claimDeviceName" placeholder="Name" />
            <button class="btn-neu-rect" id="claimBtn">Add Device</button>
            <button id="refreshBtn" class="btn-neu-rect">â†»</button>
          </div>
          <div class="device-list-wrapper">
            <table>
              <thead><tr><th>ID</th><th>TÃªn</th><th>Status</th><th>Val</th><th>Time</th><th>Ctrl</th></tr></thead>
              <tbody id="deviceTableBody"></tbody>
            </table>
          </div>

          <hr style="border-color:var(--text-soft); opacity:0.2; margin:20px 0"/>
          <div class="small"><b>ESP32 Firmware Generator</b></div>
          <div class="row" style="flex-direction:row; flex-wrap:wrap; gap:10px;">
            <input id="fwDeviceId" placeholder="Dev ID" style="flex:1" />
            <input id="fwWifiSsid" placeholder="WiFi SSID" style="flex:1" />
            <input id="fwWifiPass" placeholder="WiFi Pass" style="flex:1" />
            <input id="fwMqttHost" placeholder="Broker" value="broker.hivemq.com" style="flex:1" />
          </div>
          <div class="device-list-wrapper" style="max-height:150px; margin-top:10px">
            <table>
              <tbody id="fwPinsTableBody"></tbody>
            </table>
            <button id="fwAddPinBtn" class="btn-neu-rect" style="margin:10px; font-size:10px">+ Add Pin</button>
          </div>
          <div class="row" style="flex-direction:row; gap:10px; margin-top:15px">
            <button id="fwGenerateBtn" class="btn-neu-rect">Generate Code</button>
            <button id="fwCopyBtn" class="btn-neu-rect">Copy</button>
            <span id="fwCopyStatus" class="small" style="align-self:center"></span>
          </div>
          <textarea id="fwCodeOutput" style="width:100%; height:150px; margin-top:10px; border-radius:10px; padding:10px; border:none; box-shadow:inset 3px 3px 6px var(--neu-shadow-dark)"></textarea>
        </section>

        <section id="camerasSection" class="hidden">
          <div class="row" style="flex-direction:row; gap:10px;">
            <input id="camIdInput" placeholder="Cam ID" />
            <input id="camNameInput" placeholder="Name" />
            <input id="camUrlInput" placeholder="Snapshot URL" />
            <button id="camRegisterBtn" class="btn-neu-rect">Add</button>
          </div>
          <div class="device-list-wrapper">
            <table>
              <thead><tr><th>ID</th><th>Name</th><th>Action</th></tr></thead>
              <tbody id="cameraTableBody"></tbody>
            </table>
          </div>
          <hr style="border-color:var(--text-soft); opacity:0.2; margin:20px 0"/>
          <div class="row" style="flex-direction:row; gap:10px; align-items:center">
            <button id="startStreamBtn" class="btn-neu-rect">Start Stream</button>
            <button id="stopStreamBtn" class="btn-neu-rect" style="color:var(--danger)" disabled>Stop</button>
            <span id="camStreamStatus" class="small">Stopped</span>
          </div>
          <div class="row" style="flex-direction:row; gap:20px; margin-top:20px">
            <div style="flex:1"><div class="small">Local:</div><video id="localVideo" autoplay muted></video></div>
            <div style="flex:1"><div class="small">Server:</div><img id="serverVideo" /></div>
          </div>
        </section>

        <section id="adminSection" class="hidden">
          <div class="device-list-wrapper">
            <table>
              <thead><tr><th>ID</th><th>User</th><th>Role</th><th>Action</th></tr></thead>
              <tbody id="adminUserTableBody"></tbody>
            </table>
          </div>
        </section>
      </div>

      <div class="card detail-card" id="detailPanel">
        <h2 style="font-size:16px; margin:0 0 15px; text-align:center">Chi tiáº¿t</h2>
        <div id="detailEmpty" class="small" style="text-align:center">Chá»n thiáº¿t bá»‹ Ä‘á»ƒ xem.</div>
        
        <div id="deviceDetailPanel" class="hidden">
          <div class="small">ID: <b id="detailId"></b></div>
          <div class="small">Name: <b id="detailName"></b></div>
          <div class="small">State: <span id="detailState"></span></div>
          <div class="small">Val: <b id="detailValue"></b></div>
          <div class="small" style="margin-top:10px">Sensors:</div>
          <div id="detailSensors" class="small" style="padding:10px; border-radius:10px; box-shadow:inset 3px 3px 6px var(--neu-shadow-dark)"></div>
          <canvas id="historyCanvas" style="width:100%; height:100px; margin-top:15px"></canvas>
        </div>

        <div id="cameraDetailPanel" class="hidden">
          <div class="small">ID: <b id="camDetailId"></b></div>
          <div class="small">URL: <a id="camDetailUrl" target="_blank" href="#">Link</a></div>
          <img id="camDetailImg" class="cam-preview" style="width:100%; margin-top:10px; border-radius:10px" />
        </div>
      </div>
    </div>
  </div>

  <div id="widgetConfigOverlay" class="widget-config-overlay">
    <div id="widgetConfigPanel" class="widget-config">
      <div class="widget-config-header">
        <span>Cáº¥u hÃ¬nh</span><button class="btn-neu-rect" id="widgetConfigCloseBtn" style="padding:5px 10px">âœ•</button>
      </div>
      <div class="widget-config-form">
        <div class="widget-config-row"><span>TÃªn</span><input id="widgetConfigTitle" /></div>
        <div class="widget-config-row"><span>Device</span><select id="widgetConfigDevice"></select></div>
        <div class="widget-config-row"><span>Camera</span><select id="widgetConfigCamera"></select></div>
        <div class="widget-config-row"><span>Sensor Key</span><input id="widgetConfigSensor" placeholder="temp, hum..." /></div>
        
        <div class="widget-config-row"><span>CÃ´ng thá»©c</span><input id="widgetConfigFormula" placeholder="vd: x * 0.488" /></div>
        <div class="small" style="margin-left:90px; margin-bottom:5px; opacity:0.7">(x lÃ  giÃ¡ trá»‹ thÃ´ tá»« ESP32)</div>

        <div class="widget-config-row"><span>MÃ u</span>
          <select id="widgetConfigTheme">
            <option value="green">Xanh lÃ¡</option><option value="blue">Xanh dÆ°Æ¡ng</option>
            <option value="amber">Cam</option><option value="pink">Há»“ng</option>
          </select>
        </div>
        <div class="widget-config-row"><span>Size</span>
          <select id="widgetConfigSize">
            <option value="s">Nhá» (3 Ã´)</option><option value="m">Vá»«a (4 Ã´)</option><option value="l">Lá»›n (6 Ã´)</option>
          </select>
        </div>
        <div class="widget-config-row" id="widgetConfigRangeRow" style="display:none">
          <span>Range</span><input id="widgetConfigRangeMin" type="number" placeholder="Min" style="width:60px" />
          <input id="widgetConfigRangeMax" type="number" placeholder="Max" style="width:60px" />
        </div>
      </div>
    </div>
  </div>

  <script>
    function switchAuth(tab) {
      document.getElementById('loginForm').style.display = tab==='login'?'block':'none';
      document.getElementById('registerForm').style.display = tab==='register'?'block':'none';
      document.getElementById('tabLogin').className = tab==='login'?'active':'';
      document.getElementById('tabRegister').className = tab==='register'?'active':'';
    }
  </script>
  <script src="app.js" defer></script>
</body>
</html>