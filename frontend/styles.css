:root {
  /* COLORS */
  --bg-color: #e0e5ec; --text-color: #4a5568; --text-soft: #a0aec0;
  --neu-shadow-light: #ffffff; --neu-shadow-dark: #a3b1c6;
  --acc: #10b981; --acc2: #3b82f6; --danger: #ef4444;
  /* GRID: Thu nhỏ widget */
  --grid-cols: 12; --grid-row-height: 80px; 
  --rad: 15px; --trans: all 0.2s ease;
}

[data-theme="dark"] {
  --bg-color: #2d3748; --text-color: #e2e8f0; --text-soft: #718096;
  --neu-shadow-light: #3a475c; --neu-shadow-dark: #1a202c;
}

* { box-sizing: border-box; margin: 0; padding: 0; }
body { font-family: sans-serif; background-color: var(--bg-color); color: var(--text-color); transition: background-color 0.3s; }

/* UTILS */
.full-center { min-height: 100vh; display: flex; align-items: center; justify-content: center; padding: 15px; }
.hidden { display: none !important; }
.row { display: flex; gap: 10px; margin-bottom: 10px; }
.small { font-size: 12px; color: var(--text-soft); }

/* --- NEUMORPHISM BUTTONS --- */
.btn-neu-rect {
  border: none; outline: none; cursor: pointer;
  background: var(--bg-color); color: var(--text-color);
  padding: 10px 15px; border-radius: 10px; font-weight: 600; font-size: 12px;
  box-shadow: 5px 5px 10px var(--neu-shadow-dark), -5px -5px 10px var(--neu-shadow-light);
  transition: var(--trans);
}
.btn-neu-rect:hover:not(:disabled) { transform: translateY(-2px); color: var(--acc2); }
.btn-neu-rect:active, .btn-neu-rect.active {
  box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light);
  transform: translateY(0); color: var(--acc);
}
.btn-neu-rect:disabled { opacity: 0.6; cursor: not-allowed; }

.icon-btn {
  width: 32px; height: 32px; border-radius: 50%; border: none; cursor: pointer;
  background: var(--bg-color); color: var(--text-color);
  display: flex; align-items: center; justify-content: center; font-size: 14px;
  box-shadow: 4px 4px 8px var(--neu-shadow-dark), -4px -4px 8px var(--neu-shadow-light);
}
.icon-btn:active { box-shadow: inset 2px 2px 4px var(--neu-shadow-dark), inset -2px -2px 4px var(--neu-shadow-light); }

/* INPUTS */
input, select, textarea {
  width: 100%; border: none; outline: none; background: var(--bg-color); color: var(--text-color);
  padding: 10px 15px; border-radius: 8px; font-size: 13px;
  box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light);
  margin-bottom: 10px; transition: var(--trans);
}
input:focus { box-shadow: inset 5px 5px 10px var(--neu-shadow-dark), inset -5px -5px 10px var(--neu-shadow-light); color: var(--acc2); }

/* LAYOUT */
.layout { display: grid; grid-template-columns: 220px 1fr; gap: 20px; max-width: 1600px; margin: 0 auto; padding: 20px; height: 100vh; }
.sidebar, .main-content { background: var(--bg-color); border-radius: 20px; padding: 20px; box-shadow: 8px 8px 16px var(--neu-shadow-dark), -8px -8px 16px var(--neu-shadow-light); }
.main-content { overflow-y: auto; box-shadow: inset 5px 5px 10px var(--neu-shadow-dark), inset -5px -5px 10px var(--neu-shadow-light); }
.sidebar-nav { display: flex; flex-direction: column; gap: 10px; margin-top: 20px; }
.nav-item { justify-content: flex-start; }

/* DASHBOARD */
.dash-toolbar { display: flex; justify-content: space-between; margin-bottom: 15px; flex-wrap: wrap; }
.widget-grid { display: grid; grid-template-columns: repeat(var(--grid-cols), 1fr); grid-auto-rows: var(--grid-row-height); gap: 15px; padding: 5px; }
.widgets-edit { border: 2px dashed var(--text-soft); border-radius: 15px; }

/* WIDGET CARD (Nhỏ gọn hơn) */
.widget-card {
  background: var(--bg-color); border-radius: 15px; padding: 10px;
  box-shadow: 5px 5px 10px var(--neu-shadow-dark), -5px -5px 10px var(--neu-shadow-light);
  display: flex; flex-direction: column; justify-content: space-between; position: relative;
}
.widget-header { display: flex; justify-content: space-between; font-size: 11px; font-weight: bold; color: var(--text-soft); margin-bottom: 5px; }
.widget-body { flex: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }

/* COMPONENTS */
/* Nút Switch Tròn Đẹp */
.widget-switch-btn {
  width: 50px; height: 50px; border-radius: 50%; border: none; cursor: pointer;
  background: var(--bg-color); color: var(--text-soft); font-size: 20px;
  display: flex; align-items: center; justify-content: center;
  box-shadow: 5px 5px 10px var(--neu-shadow-dark), -5px -5px 10px var(--neu-shadow-light);
  transition: var(--trans);
}
.widget-switch-btn.on { color: var(--acc); box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light); }

.widget-slider-row input[type=range] { height: 8px; border-radius: 4px; padding: 0; margin: 5px 0; }
.widget-value-big { font-size: 22px; font-weight: 800; }
.widget-action-btn { width: 100%; padding: 10px; border-radius: 10px; font-weight: bold; color: var(--acc2); box-shadow: 5px 5px 10px var(--neu-shadow-dark), -5px -5px 10px var(--neu-shadow-light); background: var(--bg-color); border:none; cursor: pointer; }
.widget-action-btn:active { box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light); }

/* D-Pad */
.widget-dpad { display: flex; flex-direction: column; align-items: center; gap: 5px; }
.widget-dpad-row { display: flex; gap: 5px; }
.dpad-btn { width: 30px; height: 30px; border-radius: 6px; border: none; background: var(--bg-color); box-shadow: 3px 3px 6px var(--neu-shadow-dark), -3px -3px 6px var(--neu-shadow-light); cursor: pointer; }
.dpad-btn:active { box-shadow: inset 2px 2px 4px var(--neu-shadow-dark), inset -2px -2px 4px var(--neu-shadow-light); color: var(--acc2); }

/* AUTH CARD */
.auth-card { width: 100%; max-width: 350px; padding: 30px; border-radius: 20px; background: var(--bg-color); box-shadow: 10px 10px 20px var(--neu-shadow-dark), -10px -10px 20px var(--neu-shadow-light); }
.tabs { display: flex; gap: 10px; margin-bottom: 20px; } .tabs button { flex: 1; }

/* POPUP */
.widget-config-overlay { position: fixed; inset: 0; display: none; align-items: center; justify-content: center; background: rgba(0, 0, 0, 0.4); z-index: 50; backdrop-filter: blur(2px); }
.widget-config-overlay.open { display: flex; }
.widget-config { background: var(--bg-color); border-radius: 20px; padding: 20px; width: 350px; box-shadow: 10px 10px 30px var(--neu-shadow-dark), -10px -10px 30px var(--neu-shadow-light); }
.widget-config-header { display: flex; justify-content: space-between; margin-bottom: 15px; font-weight: bold; font-size: 16px; }
.widget-config-row { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
.widget-config-row span { width: 80px; font-size: 12px; color: var(--text-soft); }

/* PALETTE */
.widget-palette { position: relative; }
.widget-palette-menu { position: absolute; right: 0; top: 110%; background: var(--bg-color); border-radius: 15px; padding: 10px; display: none; flex-direction: column; gap: 5px; min-width: 150px; z-index: 20; box-shadow: 5px 5px 15px var(--neu-shadow-dark); }
.widget-palette-menu.open { display: flex; }
.widget-type-btn { text-align: left; background: transparent; padding: 8px; border-radius: 8px; color: var(--text-color); border:none; cursor:pointer; }
.widget-type-btn:hover { background: rgba(0,0,0,0.05); color: var(--acc2); }

/* OTHER */
img.cam-preview, video { width: 100%; border-radius: 10px; box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light); }
.device-list-wrapper { max-height: 300px; overflow-y: auto; box-shadow: inset 3px 3px 6px var(--neu-shadow-dark), inset -3px -3px 6px var(--neu-shadow-light); padding:10px; border-radius:10px; }
table { width: 100%; border-collapse: collapse; font-size: 13px; }
th, td { padding: 8px; text-align: left; border-bottom: 1px solid rgba(0,0,0,0.05); }

@media(max-width: 768px) { .layout { grid-template-columns: 1fr; padding: 10px; height: auto; } .sidebar { margin-bottom: 20px; } }